<!-- Copyright Â© 2024 Huly Labs. Use of this source code is governed by the Apache 2.0 license. -->

<idea-plugin>
  <name>Huly Code Lang Configurator</name>
  <category>Other Tools</category>
  <id>hulylabs.hulycode.plugins.hulylangconfigurator</id>
  <vendor url="https://hulylabs.com/">Huly Labs</vendor>
  <description>
    Configures languages support for opened files.
  </description>

  <depends>com.intellij.modules.platform</depends>
  <depends>com.redhat.devtools.lsp4ij</depends>
  <depends>com.hulylabs.TreeSitter</depends>

  <resource-bundle>messages.HulyLangConfiguratorBundle</resource-bundle>

  <extensions defaultExtensionNs="com.intellij">
    <applicationService serviceInterface="com.intellij.platform.ide.customization.ExternalProductResourceUrls"
                        serviceImplementation="com.hulylabs.intellij.plugins.langconfigurator.HulyExternalResourceUrls"
                        overrides="true"/>
    <editorNotificationProvider
      implementation="com.hulylabs.intellij.plugins.langconfigurator.LanguageServerConfigSetupNotificationProvider"/>
    <notificationGroup id="Language Server Configuration" displayType="BALLOON"/>
    <postStartupActivity implementation="com.hulylabs.intellij.plugins.langconfigurator.ProjectStartupActivity"/>
    <workspaceModel.fileIndexContributor
      implementation="com.hulylabs.intellij.plugins.langconfigurator.gitignore.ContentRootFileIndexIgnoreContributor"/>
    <fileIconProvider implementation="com.hulylabs.intellij.plugins.langconfigurator.CustomFileIconProvider"/>
    <projectConfigurable id="hulylabs.langconfigurator.settings"
                         key="settings.display.name"
                         instance="com.hulylabs.intellij.plugins.langconfigurator.settings.Configuration"
                         dynamic="true"/>
    <themeProvider id="HulyCode Dark" path="themes/dark.theme.json" parentTheme="ExperimentalDark" targetUi="new"/>
    <themeProvider id="HulyCode Light" path="themes/light.theme.json" parentTheme="ExperimentalLight" targetUi="new"/>
    <bundledColorScheme id="GitHubDarkDimmed" path="themes/GitHub_Dark_Dimmed.xml"/>
    <bundledColorScheme id="GitHubLight" path="themes/GitHub_Light.xml"/>
    <bundledKeymap file="VSCode.xml" />
    <bundledKeymap file="VSCode OSX.xml" />

    <!-- LSP4IJ related extensions -->

    <!-- LSP file view provider to yield some PSI structure to otherwise flat files -->
    <!-- Copied from this PR https://github.com/redhat-developer/lsp4ij/pull/703 -->
    <!--<lang.fileViewProviderFactory-->
    <!--  language="TEXT"-->
    <!--  implementationClass="com.redhat.devtools.lsp4ij.features.documentSymbol.LSPDocumentFileViewProviderFactory"/>-->
    <!--<lang.fileViewProviderFactory-->
    <!--  language="textmate"-->
    <!--  implementationClass="com.redhat.devtools.lsp4ij.features.documentSymbol.LSPDocumentFileViewProviderFactory"/>-->
    <!--<lang.fileViewProviderFactory-->
    <!--  language="TreeSitter"-->
    <!--  implementationClass="com.redhat.devtools.lsp4ij.features.documentSymbol.LSPDocumentFileViewProviderFactory"/>-->
    <!-- end of copied code -->

    <lang.psiStructureViewFactory
      id="LSPDocumentSymbolStructureViewFactoryForTextMate"
      language="TreeSitter"
      implementationClass="com.redhat.devtools.lsp4ij.features.documentSymbol.LSPDocumentSymbolStructureViewFactory"/>
    <lang.foldingBuilder
      id="LSPFoldingBuilderForTextMate"
      language="TreeSitter"
      implementationClass="com.redhat.devtools.lsp4ij.features.foldingRange.LSPFoldingRangeBuilder"
      order="first"/>
    <codeBlockProvider
      language="TreeSitter"
      implementationClass="com.redhat.devtools.lsp4ij.features.foldingRange.LSPCodeBlockProvider"
      order="first"/>
    <codeInsight.parameterInfo
      id="LSPParameterInfoHandlerForTextMate"
      language="TreeSitter"
      implementationClass="com.redhat.devtools.lsp4ij.features.signatureHelp.LSPParameterInfoHandler"/>
    <typeHierarchyProvider
      language="TreeSitter"
      implementationClass="com.redhat.devtools.lsp4ij.features.typeHierarchy.LSPTypeHierarchyProvider"/>
    <callHierarchyProvider
      language="TreeSitter"
      implementationClass="com.redhat.devtools.lsp4ij.features.callHierarchy.LSPCallHierarchyProvider"/>
  </extensions>

  <projectListeners>
    <listener class="com.hulylabs.intellij.plugins.langconfigurator.settings.SaveActionsDocumentManagerListener"
              topic="com.intellij.openapi.fileEditor.FileDocumentManagerListener"/>
  </projectListeners>

  <applicationListeners>
    <listener class="com.hulylabs.intellij.plugins.langconfigurator.gitignore.GitIgnoreFileListener"
              topic="com.intellij.openapi.vfs.newvfs.BulkFileListener"/>
  </applicationListeners>

  <actions>
    <group id="WelcomeScreen.QuickStart.IDEA">
      <action id="WelcomeScreen.OpenProject" class="com.intellij.ide.actions.OpenFileAction$OnWelcomeScreen"/>
      <add-to-group group-id="WelcomeScreen.QuickStart" anchor="first"/>
    </group>
  </actions>
</idea-plugin>
